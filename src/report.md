# Отчет
## Part 1. Инструмент ipcalc
### 1.1. Сети и маски
- Адрес сети:\
![address_net](scr/p1/1.png)
- Перевод 255.255.255.0:
    - Прифексная: /24
    - Двоичная: 11111111.11111111.11111111.00000000
- Перевод /15:
    - Обычная: 255.254.0.0
    - Двоичная: 11111111.11111110.00000000.00000000
- Перевод 11111111.11111111.11111111.11110000:
    - Обычная: 255.255.255.240
    - Прифексная: /28
- HostMin:
    - /8: 12.0.0.1
    - 1111111.11111111.00000000.00000000: 12.167.0.1
    - 255.255.254.0: 12.167.38.1
    - /4: 0.0.0.1
- HostMax:
    - /8: 12.255.255.254
    - 1111111.11111111.00000000.00000000: 12.167.255.254
    - 255.255.254.0: 12.167.39.254
    - /4: 15.255.255.254

### 1.2. localhost
- Обращение к ip:\
![ping_ip](scr/p1/2.png)

### 1.3. Диапазоны и сегменты сетей
- Всего три диапазона приватных адресов:
    - 10.0.0.0/8 (то есть всё что начинается на 10.);
    - 172.16.0.0/12 (то есть с 172.16.0.0 по 172.31.255.255 включительно);
    - 192.168.0.0/16 (то есть со 192.168.0.0 по 192.168.255.255 включительно).
- Публичные:
    - 134.43.0.2
    - 172.0.2.1
    - 192.172.0.1
    - 172.68.0.2
    - 192.169.168.1
- Приватные:
    - 10.0.0.45
    - 192.168.4.2
    - 172.20.250.4
    - 172.16.255.255
    - 10.10.10.10
- Возможные шлюза у сети 10.10.0.0/18:
    - 10.10.0.2
    - 10.10.10.10
    - 10.10.1.255

## Part 2. Статическая маршрутизация между двумя машинами
- Сетевые интерфейсы:\
![network](scr/p2/1.png)
- Описание сетевых интерфейсов:
    - ws1:\
    ![net_inter_ws1](scr/p2/2.png)
    - ws2:\
    ![net_inter_ws2](scr/p2/3.png)
- Выполнение команды `netplan apply`:\
![netplan](scr/p2/4.png)

### 2.1. Добавление статического маршрута вручную
- Пинговка:\
![pingovka_1](scr/p2/5.png)

### 2.2. Добавление статического маршрута с сохранением
- Добавление статического маршрута:\
![static_route](scr/p2/6.png)
- Пинговка:\
![pingovka_2](scr/p2/7.png)

## Part 3. Утилита iperf3
### 3.1. Скорость соединения
- Перевод:
    - 8 Mbps = 1 MB/s
    - 100 MB/s = 100000 Kbps
    - 1 Gbps = 1000 Mbps
### 3.2. Утилита iperf3
- Скорость соединения:\
![speed](scr/p3/1.png)

## Part 4. Сетевой экран
### 4.1. Утилита iptables
- Содержание файла /etc/firewall.sh:\
![firewall](scr/p4/1.png)
- Запуск файлов:\
![exec](scr/p4/2.png)

Разница в том, что в первом файле первым правилом для пакета - запрет, а во втором - разрешение. Применяется только первое правило, остальные игнорируются.
### 4.2. Утилита nmap
- Пинговка:\
![pingovka](scr/p4/3.png)
- Вызов команды `nmap`:\
![nmap](scr/p4/4.png)

## Part 5. Статическая маршрутизация сети
### 5.1. Настройка адресов машин
- ws11:\
![np_ws11](scr/p5/1.png)
- ws21:\
![np_ws21](scr/p5/2.png)
- ws22:\
![np_ws22](scr/p5/3.png)
- r1:\
![np_r1](scr/p5/4.png)
- r2:\
![np_r2](scr/p5/5.png)
- Вызов команды `ip -4 a`:
    - ws11:\
    ![ip-4a_ws11](scr/p5/6.png)
    - ws21:\
    ![ip-4a_ws21](scr/p5/7.png)
    - ws22:\
    ![ip-4a_ws22](scr/p5/8.png)
    - r1:\
    ![ip-4a_r1](scr/p5/9.png)
    - r2:\
    ![ip-4a_r2](scr/p5/10.png)
- Пинговка:
    - ws21 -> ws22:\
    ![ping_ws21_ws22](scr/p5/11.png)
    - ws11 -> r1:\
    ![ping_ws11_r1](scr/p5/12.png)
### 5.2. Включение переадресации IP-адресов
- Вызов команды `sysctl -w net.ipv4.ip_forward=1`:
    - r1:\
    ![sysctl_r1](scr/p5/13.png)
    - r2:\
    ![sysctl_r2](scr/p5/14.png)
- Содержание файла sysctl.conf:
    - r1:\
    ![sysctl.conf_r1](scr/p5/15.png)
    - r2:\
    ![sysctl.conf_r2](scr/p5/16.png)
### 5.3. Установка маршрута по-умолчанию
- Содержание файла 00-installer-config.yaml:
    - ws11:\
    ![yaml_ws11](scr/p5/17.png)
    - ws21:\
    ![yaml_ws21](scr/p5/18.png)
    - ws22:\
    ![yaml_ws22](scr/p5/19.png)
- Вызов команды `ip r`:
    - ws11:\
    ![ip-r_ws11](scr/p5/ip_r/1.png)
    - ws21:\
    ![ip-r_ws21](scr/p5/ip_r/2.png)
    - ws22:\
    ![ip-r_ws22](scr/p5/ip_r/3.png)
- Пинговка ws11 -> r2:\
![ws11->r2](scr/p5/20.png)
- Вызов команды `tcpdump -tn -i`:\
![tcpdump](scr/p5/21.png)
### 5.4. Добавление статических маршрутов
- Содержание файла 00-installer-config.yaml:
    - r1:\
    ![yaml_r1](scr/p5/22.png)
    - r2:\
    ![yaml_r2](scr/p5/23.png)
- Вызов команды `ip r`:
    - r1:\
    ![ipr_r1](scr/p5/24.png)
    - r2:\
    ![ipr_r2](scr/p5/25.png)
- Вызов команд `ip r list 10.10.0.0/18` и `ip r list 0.0.0.0/0` на ws11:\
![ipr_list_ws11](scr/p5/26.png)

Маршрут по умолчанию имеет более низкий приоритет и срабатывает, когда не найден подходящий маршрут в таблице маршрутизации. 0.0.0.0/0 - это немаршрутизируемый адрес, который можно использовать в разных целях, в основном, в качестве адреса по умолчанию или адреса-заполнителя. Маршрут по умолчанию имеет более низкий приоритет и срабатывает, когда не найден подходящий маршрут в таблице маршрутизации. Для сети 10.10.0.0 мы создали правило, соответственно используется созданный маршрут. Также можно устанавливать метрику, чтобы менять приоритеты маршрутов.
### 5.5. Построение списка маршрутизаторов
- Вызов команды `tcpdump -tnv -i` на r1:\
![tcpdump_r1](scr/p5/27.png)
- Вызов команды `traceroute` от ws11 до ws21:\
![traceroute](scr/p5/28.png)

Принцип работы traceroute: Утилита отправляет целевому узлу несколько пакетов с временем жизни 1 (TTL, time to live - число переходов, которые пакет может осуществить до своего исчезновения). Следующий маршрутизатор принимает пакеты и отправляет сообщение, что время жизни пакетов истекло. traceroute фиксирует адрес этого маршрутизатора и отправляет следующие пакеты, уже с TTL 2. Так, каждый раз увеличивая TTL на 1, traceroute составляет список маршрутизаторов, через которе прошли пакеты до целевого узла. Для определения промежуточных маршрутизаторов traceroute отправляет серию пакетов данных целевому узлу, при этом каждый раз увеличивая на 1 значение поля TTL («время жизни»). Это поле обычно указывает максимальное количество маршрутизаторов, которое может быть пройдено пакетом. Первый пакет отправляется с TTL, равным 1, и поэтому первый же маршрутизатор возвращает обратно сообщение ICMP, указывающее на невозможность доставки данных. Traceroute фиксирует адрес маршрутизатора, а также время между отправкой пакета и получением ответа (эти сведения выводятся на монитор компьютера). Затем traceroute повторяет отправку пакета, но уже с TTL, равным 2, что позволяет первому маршрутизатору пропустить пакет дальше.
### 5.6. Использование протокола ICMP при маршрутизации
- Перехват сетевого трафика:\
![perehvat](scr/p5/29.png)
- Пинговка несуществующего IP с ws11:\
![null_ip](scr/p5/30.png)

## Part 6. Динамическая настройка IP с помощью DHCP
- Настройка файла /etc/dhcp/dhcpd.conf:\
![dhcpd](scr/p6/1.png)
- Содержание файла resolv.conf:\
![dhcpd](scr/p6/2.png)
- Вызов команды `systemctl restart isc-dhcp-server`:\
![dhcpd](scr/p6/3.png)
- Пинговка ws21 -> ws22:\
![ws21->ws22](scr/p6/4.png)
- MAC ws11:\
![mac_ws11](scr/p6/5.png)
- Настройка файла /etc/dhcp/dhcpd.conf для r1:\
![dhcpd_r1](scr/p6/6.png)
- До обновления ip ws21:\
![before](scr/p6/7.png)
- После обновления ip ws21:\
![after](scr/p6/8.png)

Команда sudo dhclient -r освобождает текущий адрес интерфейса enp0s8. Команда sudo dhclient задает новый адрес указанному интерфейсу.

## Part 7. NAT
- Содержание файла ports.conf:
    - ws22:\
    ![ports.conf_ws22](scr/p7/1.png)
    - r1:\
    ![ports.conf_r1](scr/p7/2.png)
- Вызов команды `service apache2 start`:\
![start](scr/p7/3.png)
- Пинговка(не должно) r1 -> ws22:\
![r1->ws22](scr/p7/4.png)
- Пинговка(должно) r1 -> ws22:\
![r1->ws22](scr/p7/5.png)
- Содержание файла firewall.sh:
![firewall](scr/p7/6.png)
- Вызов команды `telnet`:\
![telnet](scr/p7/7.png)

## Part 8. Дополнительно. Знакомство с SSH Tunnels
- `ssh -L 5555:localhost:80 10.20.0.20`:\
![ssh](scr/p8/1.png)
- `sudo telnet 127.0.0.1 8080`:\
![telnet](scr/p8/2.png)
- `ssh -R 5555:localhost:80 10.20.0.10` ws11:\
![ssh](scr/p8/3.png)
- `sudo telnet 127.0.0.1 8080` ws11:\
![telnet](scr/p8/4.png)